{% extends "base.html" %}

{% load crispy_forms_tags %}
{% load static i18n %}
{% load render_bundle from webpack_loader %}

{% block javascript %}
  {{ block.super }}
  {% render_bundle 'fetch_barcode' 'js' attrs='defer' %}
  {% render_bundle 'plotly_loader' 'js' attrs='defer' %}
  {% render_bundle 'tabulator_loader' 'js' attrs='defer' %}
{% endblock javascript %}
{% block css %}
  {{ block.super }}
  {% render_bundle 'tabulator_loader' 'css' attrs='defer' %}
  <style>
    .hidden-data {
      display: none;
    }
  </style>
{% endblock css %}
{% block content %}
  <div class="container-md my-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-10 col-lg-8">
        <div class="card">
          <div class="card-header">
            {% if product %}
              {% translate "Edit product" %}
            {% else %}
              {% translate "Add a new product" %}
            {% endif %}
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              {% csrf_token %}
              {% if form.errors %}
                <div class="alert alert-danger">
                  <strong>{% translate "Invalid form" %}:</strong>
                  {{ form.errors }}
                </div>
              {% endif %}
              {% crispy form %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="ingredients" class="hidden-data">{{ form.extra_data.ingredients_json|json_script:"ingredients-data" }}</div>
  <script type="text/javascript">
    window.CONFIG = {
      macronutrientsApiUrl: "{{ macronutrients_api_url }}",
    };
  </script>
  <script src="{% static 'products/js/product_form_macronutrients_graph.js' %}"></script>
  <script src="{% static 'products/js/product_form_ingredients_table.js' %}"></script>
{% endblock content %}
